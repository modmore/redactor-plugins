if(!RedactorPlugins)var RedactorPlugins={};!function(c){var t=!1;c(window).keydown(function(e){18==e.which&&(t=!0)}).keyup(function(e){18==e.which&&(t=!1)}),RedactorPlugins.speek=function(){var a,o=window.speechSynthesis.getVoices();return window.speechSynthesis.onvoiceschanged=function(e){o=window.speechSynthesis.getVoices()},{getTemplate:function(){var s=c(document.createElement("section"));s.attr("id","redactor-modal-speek"),s.append("<p>Listen as you wish.</p>"),s.append('<label for="voice">Voice</label>'),s.append(document.createElement("select")),c.each(o,function(e,t){s.find("select").attr("id","voice").attr("name","voice").append(c('<option value="'+t.name+'">'+t.name+"</option>"))});var e=c('<div class="options"></div>');return e.append('<label for="volume">Volume</label><input data-varname="speechVolume" type="range" min="0" max="1" step="0.1" name="volume" id="volume" value="1">'),e.append('<label for="rate">Rate</label><input data-varname="speechRate" type="range" min="0" max="1" step="0.1" name="Rate" id="rate" value="1">'),e.append('<label for="pitch">Pitch</label><input data-varname="speechPitch" type="range" min="0" max="1" step="0.1" name="pitch" id="pitch" value="1">'),s.append(e),c(s)[0].outerHTML},init:function(){if(!(!1 in window)){var e=this,t=this.button.add("speek","Listen");this.button.setAwesome("speek","icon icon-headphones"),this.button.addCallback(t,this.speek.clicked),c.extend(this.opts.shortcuts,{esc:{func:"speek.shutup",params:[]}}),this.$element.on("modalClosedCallback",function(){e.speek.shutup()})}},clicked:function(){t?this.speek.show():this.speek.speek()},speek:function(){var e=window.speechSynthesis.speaking;this.speek.shutup();var t=this.button.get("speek"),s=this.opts.speechVoice||"Vicki";if(!e){var n=this.code.get(),i=[];c(n).each(function(e,t){i.push(c(t).text())}),n=i.join(" "),(a=new SpeechSynthesisUtterance).text=n,a.lang=this.opts.speechLang||"en-US",a.voice=o.filter(function(e){return e.name==s})[0],a.rate=void 0!==this.opts.speechRate?this.opts.speechRate:1,a.pitch=void 0!==this.opts.speechPitch?this.opts.speechPitch:1,a.volume=void 0!==this.opts.speechVolume?this.opts.speechVolume:1,a.onend=a.onerror=function(){t.removeClass("speaking")},a.onstart=a.onresume=function(){t.addClass("speaking")},window.speechSynthesis.speak(a),t.addClass("speaking")}},show:function(){var e=this.button.get("speek"),t=this;this.modal.addTemplate("choose-voice",this.speek.getTemplate()),this.modal.load("choose-voice",this.lang.get("choose-voice")||"Choose Voice",300),this.modal.createCancelButton(),(e=this.modal.createActionButton("Listen")).on("click",this.speek.close),c("#redactor-modal-speek select").on("change",function(){var e=c(this).val();t.speek.vocalChange(e)}),c("#redactor-modal-speek select").val(t.opts.speechVoice),c("#redactor-modal-speek #volume, #redactor-modal-speek #rate, #redactor-modal-speek #pitch").each(function(){c(this).on("change",function(){e=t.button.get("speek"),t.opts[c(this).data("varname")]=c(this).val(),t.speek.shutup(),t.speek.speek(),e.addClass("speaking")}).val(t.opts[c(this).data("varname")])}),this.selection.save(),this.modal.show()},close:function(){this.modal.close(),this.speek.shutup(),this.speek.speek(),this.selection.restore()},vocalChange:function(t){var e=this.button.get("speek"),s=o.filter(function(e){return e.name==t})[0];s&&(this.opts.speechVoice=s.name,this.speek.shutup(),this.speek.speek(),e.addClass("speaking"))},shutup:function(){var e=!!window.speechSynthesis.speaking;window.speechSynthesis.cancel();var t=this.button.get("speek");if(a)try{a.cancel()}catch(e){}return window.speechSynthesis.cancel(),a=null,t.removeClass("speaking"),e}}}}(jQuery);