if(!RedactorPlugins)var RedactorPlugins={};!function(a){RedactorPlugins.clips=function(){return{json:null,tags:[],getTemplate:function(){function b(a){return a.filter(function(a,b,c){return b===c.indexOf(a)})}var c=this,d=this.clips.json,e=a(document.createElement("section")).attr("id","redactor-modal-clips").append([a(document.createElement("select")).hide().append(a(document.createElement("option")).attr("value","").text("All")),a(document.createElement("ul")).addClass("redactor_clips_box")]);if(d&&d.length){var f=a(".clipsmodal").size(),g="clipsmodal-"+f;e.attr("id",g);c.clips.tags;a.each(d,function(d,f){var g=a('<li class="redactor_clip_item"><a href="#" class="redactor_clip_link"'+(1==f.advanced?' data-advanced="1"':"")+'></a><div class="redactor_clip" style="display:none"></div></li>');g.children("a").html(f.title),g.children(".redactor_clip").html(f.clip),f.tags&&(g.addClass(f.tags),c.clips.tags=b(a.merge(c.clips.tags,f.tags.split(" ")))),e.find(".redactor_clips_box").append(g)})}return a(e)[0].outerHTML},init:function(){if(this.opts.clipsJson){if("string"==typeof this.opts.clipsJson)try{this.clips.json=a.parseJSON(this.opts.clipsJson)}catch(a){return!1}this.clips.json||(this.clips.json=this.opts.clipsJson);var b=this.button.addAfter("link","clips","Clips");b.addClass("re-icon re-clips"),this.button.addCallback(b,this.clips.show)}},filter:function(b){if(b.trim()){b=b.trim().split(" "),a("#redactor-modal").find(".redactor_clip_item").hide();for(var c=0;c<b.length;c++){var d=b[c].trim();d&&a("#redactor-modal").find(".redactor_clip_item."+d).show()}}else a("#redactor-modal").find(".redactor_clip_item").show()},show:function(){var b=this;this.modal.addTemplate("clips",this.clips.getTemplate()),this.modal.load("clips",this.lang.get("clips")||"Clips",300),this.modal.createCancelButton(),this.selection.save(),this.modal.show();var c=b.clips.tags;if(c.length){a("#redactor-modal").find("select").show();for(var d=0;d<c.length;d++)a("#redactor-modal").find("select").append(a(document.createElement("option")).attr("value",c[d]).text(c[d]))}a("#redactor-modal").find("select").on("change",function(){b.clips.filter(a(this).find("option:selected").val().trim())}),a("#redactor-modal").find(".redactor_clips_box a").on("click",a.proxy(this.clips.clipClicked,this))},clipClicked:function(b){this.clips.insertClip(a(b.target).next().html(),void 0!==a(b.target).data("advanced"))},insertClip:function(a,b){this.selection.restore(),this.clean.isSingleLine(a),b?this.insert.htmlWithoutClean(a):this.insert.html(a,!0),this.modal.close(),this.observe.load()}}}}(jQuery);