if(!RedactorPlugins)var RedactorPlugins={};!function(a){RedactorPlugins.clips=function(){return{json:null,tags:[],getTemplate:function(){var s=this,t=this.clips.json;var l=a(document.createElement("section")).attr("id","redactor-modal-clips").append([a(document.createElement("select")).hide().append(a(document.createElement("option")).attr("value","").text("All")),a(document.createElement("ul")).addClass("redactor_clips_box")]);if(t&&t.length){var i="clipsmodal-"+a(".clipsmodal").size();l.attr("id",i);s.clips.tags;a.each(t,function(t,i){var e=a('<li class="redactor_clip_item"><a href="#" class="redactor_clip_link"'+(1==i.advanced?' data-advanced="1"':"")+'></a><div class="redactor_clip" style="display:none"></div></li>');e.children("a").html(i.title),e.children(".redactor_clip").html(i.clip),i.tags&&(e.addClass(i.tags),s.clips.tags=function(t){return t.filter(function(t,i,e){return i===e.indexOf(t)})}(a.merge(s.clips.tags,i.tags.split(" ")))),l.find(".redactor_clips_box").append(e)})}return a(l)[0].outerHTML},init:function(){if(this.opts.clipsJson){if("string"==typeof this.opts.clipsJson)try{this.clips.json=a.parseJSON(this.opts.clipsJson)}catch(t){return!1}this.clips.json||(this.clips.json=this.opts.clipsJson);var t=this.button.addAfter("link","clips","Clips");t.addClass("re-icon re-clips"),this.button.addCallback(t,this.clips.show)}},filter:function(t){if(t.trim()){t=t.trim().split(" "),a("#redactor-modal").find(".redactor_clip_item").hide();for(var i=0;i<t.length;i++){var e=t[i].trim();e&&a("#redactor-modal").find(".redactor_clip_item."+e).show()}}else a("#redactor-modal").find(".redactor_clip_item").show()},show:function(){var t=this;this.modal.addTemplate("clips",this.clips.getTemplate()),this.modal.load("clips",this.lang.get("clips")||"Clips",300),this.modal.createCancelButton(),this.selection.save(),this.modal.show();var i=t.clips.tags;if(i.length){a("#redactor-modal").find("select").show();for(var e=0;e<i.length;e++)a("#redactor-modal").find("select").append(a(document.createElement("option")).attr("value",i[e]).text(i[e]))}a("#redactor-modal").find("select").on("change",function(){t.clips.filter(a(this).find("option:selected").val().trim())}),a("#redactor-modal").find(".redactor_clips_box a").on("click",a.proxy(this.clips.clipClicked,this))},clipClicked:function(t){this.clips.insertClip(a(t.target).next().html(),void 0!==a(t.target).data("advanced"))},insertClip:function(t,i){this.selection.restore(),this.clean.isSingleLine(t),i?this.insert.htmlWithoutClean(t):this.insert.html(t,!0),this.modal.close(),this.observe.load()}}}}(jQuery);